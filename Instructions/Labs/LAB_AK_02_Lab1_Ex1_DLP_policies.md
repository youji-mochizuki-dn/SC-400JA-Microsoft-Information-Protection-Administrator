# ラボ 2 演習 1 - DLP ポリシーを管理する

あなたは Contoso Ltd. が新しく採用したコンプライアンス管理者、Joni Sherman です。データ損失防止の目的で、組織の Microsoft 365 テナントを構成する任務を負っています。Contoso Ltd. は米国で運転指導を提供している会社であり、顧客の機密情報が組織から流出しないようにする必要があります。

### タスク 1 - テスト モード で DLP ポリシーを作成する

この演習では、コンプライアンス センターでデータ損失防止ポリシーを作成し、ユーザーが機密データを共有することを防止します。作成する DLP ポリシーは、ユーザーがクレジット カード情報を含むコンテンツを共有したい場合に通知を行い、この情報を送信する正当な理由を提供する機会を提供します。このブロックのアクションがユーザーに影響を与えないよう、このポリシーはテスト モードで実行されます。

1. Client 1 VM (LON-CL1) に **lon-cl1\admin** アカウントでログインします。

2. **Microsoft Edge** で、**https://compliance.microsoft.com** に移動し、**Joni Sherman** としてコンプライアンス センターにログインします。 JoniS@WWLxZZZZZZ.onmicrosoft.com (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID) としてサインインしましょう。  Joni のパスワードは、ラボ ホスティング プロバイダーから支給されます。

3. **コンプライアンス センター**の左側のナビゲーション ウィンドウで**「ポリシー」**を選択し、**「データ」**で**「データ損失の防止」**を選択します。

4. **「データ損失の防止」**ウィンドウで**「ポリシー」**タブを選択してから**「+ポリシーの作成」**を選択し、新しいデータ損失防止ポリシーを作成するウィザードを開始します。

5. **「テンプレートを使用するか、カスタム ポリシーを作成する」**ページの左側のウィンドウで**「カスタム」**、真ん中のウィンドウで**「カスタム ポリシー」**を選択しますが、デフォルトでどちらのオプションもすでに選択済みとなっています（もしそうでない場合は、ここで両方とも選択しましょう）。**「次へ」**を選択しましょう。

6. **「DLP ポリシーの名前を設定」**ページで、*「クレジット カードの DLP ポリシー」*を**「名前」**フィールドに、*「クレジット カード番号を共有しないようにする。」*を**「説明」**フィールドに入力します。**「次へ」**をクリックします。

7. **「ポリシーを適用する場所を選択する」**ページで **Teams のチャットおよびチャンネル メッセージ** オプションのみを有効にする選択をし、**「次へ」**を選択します。

8. **「ポリシーの設定の定義」**ページで、**「詳細な DLP ルールを作成またはカスタマイズします」**オプションを選択する必要があります（既定では選択されています）。**「次へ」**をクリックします。

9. **「詳細な DLP ルールのカスタマイズ」**ページで、**「+ ルールの作成」**を選択します。

10. **「ルールの作成」**ページの**「名前」**フィールドに、*「クレジット カード情報」*と入力します。

11. **「条件」**の下で、**「+ 条件の追加」**を選択し、ドロップダウン メニューから**「コンテンツに含まれている」**を選択します。

12. **「ルールの作成」**ページの、新しい**「コンテンツに含まれている」**エリアで、**「追加」**を選択し、ドロップダウン メニューから**「機密情報の種類」**を選択します。

13. **「機密情報の種類」**ページで**「クレジット カード番号」**を選択し、**「追加」**を選択します。

14. **「ルールの作成」**ページで**「+ 条件の追加」**を選択し、ドロップダウン メニューから **「Microsoft 365 からコンテンツを共有する」**を選択します。

15. **「Microsoft 365 からコンテンツを共有する」**セクションで**「組織内の連絡先のみ」**オプションを選択します（既定では選択されています）。

16. **「ルールの作成」**ページで**「+ アクションの追加」**を選択し、**「アクセスの制限または Microsoft 365 のコンテンツの暗号化」**を選択します。

17. **「アクセスの制限または Microsoft 365 のコンテンツの暗号化」**の前のボックスをチェックし、**「全員をブロック」**を選択します。**コンテンツの所有者、最終更新者、サイト管理者のみが引き続きアクセスすることができます。**

18. **「ルールの作成」**ページの、**「ユーザー通知」**セクションで、スイッチを選択し、**「On」**のポジションにします。

19. **「ルールの作成」**ページの、**「ユーザーによる上書き」**セクションで、スイッチを選択して**「On」**のポジションにし**「上書きするには業務上の理由が必要です」**オプションを選択します。

20. **「インシデント レポート」**セクションの、**「管理者通知とレポートでこの重要度レベルを使用します」**ドロップダウンで**「低」**を選択します。

21. **「インシデント レポート」**セクションで、**「ルールの一致が発生した場合に管理者にアラートを送信します。」**スイッチを選択し、**「On」**のポジションにし、オプションをレビューします。既定の設定はポリシーを作成するユーザーに通知を行います。

22. **「保存」**を選択し、**「次へ」**を選択します。

23. **「テストを行うかポリシーを有効にする」**ページで、**「最初にテストする」**を選択し、**「テスト モード中にポリシー ヒントを表示します」**を選択します。

24. **「次へ」**を選択し、ポリシー構成を確認します。

25. **「送信」**を選択し、ポリシーを作成します。

26. ポリシーが作成されたら、**「完了」**を選択します。

作成した DLP ポリシーでは、Microsoft Teams のチャットおよびチャンネルのクレジット カード番号を探してスキャンし、ユーザーに対してポリシーをオーバーライドする業務上の正当な理由を提供するよう求めます。

### タスク 2 - DLP ポリシーを修正する

このタスクでは、前のタスクで作成した、既存の DLP ポリシーを修正し、クレジット カード情報を探してメールもスキャンし、メール内のこのコンテンツを共有するかどうかをユーザーに通知するようにします。

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。 

2. **Microsoft Edge** で、「Office 365 コンプライアンス センター」タブを開いておく必要があります。そうなっている場合は、それを選択し、次の手順に進みます。閉じてしまった場合は、新しいタブで **https://compliance.microsoft.com** に移動します。

3. **コンプライアンス センター**の左側のナビゲーション ウィンドウで**「ポリシー」**を選択し、**「データ」**で**「データ損失の防止」**を選択します。

4. **「データ損失防止」**ウィンドウで、**「ポリシー」**タブを選択し、**「クレジット カードの DLP ポリシー」**と名づけられたポリシーを選択し、それから**「ポリシーの編集」**を選択して、ポリシー ウィザードを開きます。

5. **「DLP ポリシーの名前の設定」**ページで**「次へ」**を選択します。

6. **「ポリシーを適用する場所の選択」**ページで、**「Exchange メール」**オプションを有効にし、それから**「ポリシーの確認と作成」**ページが開くまで**「次へ」**を選択します。

7. **「送信」**を選択して、ポリシーに行った変更を適用します。

既存の DLP ポリシーが修正され、コンテンツを探してスキャンする場所が変更されました。

### タスク 3 - PowerShell に DLP ポリシーを作成する

このタスクでは、PowerShell を用いて DLP ポリシーを作成し、顧客の運転免許証の番号を保護し、Exchange 上で共有されることを防止します。ユーザーには機密データが共有されようとしていることと、運転免許証の番号が含まれるメールは送信がブロックされることが通知されます。

1. Client 1 VM (LON-CL1) に **lon-cl1\admin** アカウントでログインしておきます。

2. スタート メニューで、**Windows PowerShell** を選択します。

3. **PowerShell** ウィンドウで、**「Connect-IPPSSession」** と入力し、**Joni Sherman** としてサインインします。 JoniS@WWLxZZZZZZ.onmicrosoft.com (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID) としてサインインしましょう。  Joni のパスワードは、ラボ ホスティング プロバイダーから支給されます。

4. 次のコマンドを PowerShell に入力し、すべての Exchange メールボックスをスキャンする DLP ポリシーを作成します。

	`New-DlpCompliancePolicy -Name "Driver's License DLP Policy" -Comment "This policy blocks sharing of Driver's License Numbers." -ExchangeLocation All`

5. 次のコマンドを PowerShell に入力し、前のステップで作成した DLP ポリシーに DLP ルールを追加します。

	`New-DlpComplianceRule -Name "Driver's License Rule" -Policy "Driver's License DLP Policy" -BlockAccess $true -ContentContainsSensitiveInformation @{Name="U.S. Driver's License Number";minCount="1";minconfidence="75"}`

6. 次のコマンドを用いて **運転免許証の DLP ポリシー**を見直します。

	`Get-DLPComplianceRule -Identity "Driver's License Rule"`

PowerShell を利用して、Exchange 内の運転免許証の番号をスキャンする DLP ポリシー が作成されました。

### タスク 4 - テスト モードでポリシーをアクティブにする

このタスクでは、テストモードで作成したクレジット カード情報の DLP ポリシーをアクティブ化し、保護アクションを強化します。

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。 

2. **Microsoft Edge** で、「Office 365 コンプライアンス センター」タブを開いておく必要があります。そうなっている場合は、それを選択し、次の手順に進みます。閉じてしまった場合は、新しいタブで **https://compliance.microsoft.com** に移動します。

3. **コンプライアンス センター**の左側のナビゲーション ウィンドウで**「ポリシー」**を選択し、**「データ」**で**「データ損失の防止」**を選択します。

4. **「データ損失防止」**ウィンドウで、**「ポリシー」**タブを選択し、**「クレジット カードの DLP ポリシー」**と名づけられたポリシーを選択し、それから**「ポリシーの編集」**を選択して、ポリシー ウィザードを開きます。

5. **「テストを行うかポリシーを有効にする」**ページが開くまで**「次へ」**を選択し、**「すぐに有効にします」**を選択します。

6. **「次へ」**を選択し、**「送信」**を選択してポリシーをアクティブ化します。

7. ポリシーが更新されたら、**「完了」**を選択します。

DLP ポリシーがアクティブ化されました。ポリシーはクレジット カード情報を共有しようとする試みを探知すると、それをブロックし、ユーザーにはそのブロックのアクションをオーバーライドする業務上の正当な理由を提供することを許可します。

### タスク 5 - ポリシーの優先順位を修正する

DLP ポリシーを 2 つ作成したところで、より制限の厳しいポリシーが、より制限の緩いポリシーより優先して処理されるようにします。このため、運転免許証のポリシーにより高い優先順位を与えます。

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** としてログインしておく必要があります。 

2. **Microsoft Edge** で、「Office 365 コンプライアンス センター」タブを開いておく必要があります。そうなっている場合は、それを選択し、次の手順に進みます。閉じてしまった場合は、新しいタブで **https://compliance.microsoft.com** に移動します。

3. **コンプライアンス センター**の左側のナビゲーション ウィンドウで**「ポリシー」**を選択し、**「データ」**で**「データ損失の防止」**を選択します。

4. **「データ損失防止」**ウィンドウで、**「ポリシー」**タブを選択し、**「運転免許証の DLP ポリシー」**の隣にある 3 つの縦向きドットを選択し、**「アクション」**の選択肢を開きます。

5. **「一番上へ移動」**を選択します。

6. **「データ損失の防止」**ウィンドウで、**「更新」**を選択し、「ポリシー」タブの**「順序」**の列で優先順位を確認します。

DLP ポリシーの優先順位が修正されました。両方のポリシーが同じコンテンツに一致する場合、より高い優先順位を持つアクションが実行されます。

### タスク 6 - Microsoft Cloud App Security (MCAS) でのファイルの監視を有効にする

Microsoft Cloud App Security のファイル ポリシーを使用し、OneDrive for Business と SharePoint Online の場所にあるファイルを保護します。ファイル ポリシーを作成するには、組織内のファイルを MCAS がスキャンできるようにファイル監視を有効にする必要があります。

1. Client 1 VM (LON-CL1) に **lon-cl1\admin** アカウントでログインしておきます。

2. **Microsoft Edge** で、**https://portal.cloudappsecurity.com** に移動し、**MOD 管理者** admin@WWLxZZZZZZ.onmicrosoft.com として Cloud App Security ポータルにログインします (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID)。  管理者のパスワードは、ラボ ホスティング プロバイダーから支給されます。

3. 右上角のプロフィール情報の隣で、**「設定」**の歯車を選択し、ドロップダウン メニューから**「設定」**を選択します。

4. **「設定」**ページの**「情報保護」**で**「ファイル」**を選択します。

5. まだマークされていない場合は、**「ファイル監視を有効にする」**のチェックボックスを選択し、**「保存」**を選択します。

MCAS におけるファイル監視が有効になりました。ファイル ポリシーを使って機密のコンテンツを探してファイルをスキャンすることができます。

### タスク 7 – MCAS 向けにファイル ポリシーを作成する

このタスクでは、Microsoft Cloud App Security でファイル ポリシーを作成し、OneDrive for Business と SharePoint Online のファイルをスキャンし、クレジット カード情報を含むファイルが共有されている場合はそのファイルを自動的に検疫を行います。

1. Client 1 VM (LON-CL1) には **lon-cl1\admin** アカウントでログインし、Microsoft 365 には **Joni Sherman** JoniS@WWLxZZZZZZ.onmicrosoft.com (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID) としてログインしておく必要があります。  Joni のパスワードは、ラボ ホスティング プロバイダーから支給されます。

2. **Microsoft Edge** で、「Cloud App Security ポータル」タブを開いておく必要があります。そうなっている場合は、それを選択し、次の手順に進みます。閉じてしまった場合は、新しいタブで **https://portal.cloudappsecurity.com** に移動します。

3. **Microsoft Cloud App Security ポータル**の左側のナビゲーション ウィンドウで、**「制御」**を展開し、**「ポリシー」**を選択します。

4. **「ポリシー」**ページで、**「+ ポリシーの作成」**を展開し、**「ファイル ポリシー」**を選択します。

5. **「ファイル ポリシーの作成」**ページで、*「ファイルのクレジット カード情報」*を**「ポリシー名」**フィールドに、*「クレジット カード番号がファイルで共有されることを防ぐ。」*を**「説明」**フィールドに入力します。

6. **「ポリシー重要度」**は**「低」**とし、**「カテゴリー」**が**「DLP」**に設定されていることを確認します。ファイル ポリシーでは、これが既定の設定です。

7. **「このポリシーが動作するファイルのフィルターを作成します」**エリアで、ドロップダウン メニュー**「公開 (インターネット)」、「外部」、「公開」**を展開し、**「内部」**を追加します。

8. **「検査方法」**ドロップダウン メニューで、**「データ分類サービス」**を選択します。

9. **「検査の種類を選択…」**ドロップダウン メニューで**「機密情報の種類…」**を選択します。

10. **「機密情報の種類を選択」**ダイアログで、**「クレジット カード番号」**を選択肢、右上角で**「完了」**を選択します。

11. **「アラート」**で、**「一致したファイルごとにアラートを作成する」**チェックボックスにチェックを入れ、オプションを確認します。設定を規定値として保存します。

12. **「ガバナンス アクション」**セクションで、**「Microsoft OneDrive for Business」**を展開し、**「ユーザー検疫に配置」**を選択します。

13. **「ガバナンス アクション」**セクションで、**「Microsoft SharePoint Online」**を展開し、**「ユーザー検疫に配置」**を選択します。

14. ページの下部にある**「作成」**を選択します。

OneDrive for Business と SharePoint に保存されたファイルを継続的にスキャンしてクレジット カード情報を探し、組織内で共有されている場合検疫を行うファイル ポリシーが作成されました。

### タスク 8 - PowerShell に DLP ポリシーを作成する

会社では Power Automate のフローを用いて、データを SharePoint Online と SalesForce で共有します。このタスクでは、既存のフローを続行させつつ、SharePoint Online とビジネス以外として定義されたアプリとの間でデータを共有するフローの作成を防止する、PowerPlatform 向けの DLP ポリシーを作成します。

1. Client 2 VM (LON-CL1) に **lon-cl2\admin** アカウントでログインします。

2. **Microsoft Edge** で、**https://admin.powerplatform.microsoft.com** に移動し、**MOD 管理者** admin@WWLxZZZZZZ.onmicrosoft.com として Power Platform 管理センターにログインします (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID)。  管理者のパスワードは、ラボ ホスティング プロバイダーから支給されます。

3. **Power Platform 管理センター**の、左側のナビゲーション ウィンドウで、**「データ ポリシー」**を選択します。

4. **「データ ポリシー」**ページで**「+ 新しいポリシー」**を選択します。

5. **「ポリシーの名前を設定」**ページで、*「Tenant-wide SharePoint Policy」*と入力して、**「次へ」**を選択します。

6. **「ビジネス以外」**タブで**「SharePoint」**と**「Salesforce」**を選択し、ページ上部の**「ビジネスに移行」**を選択します。

7. **「コネクタの割り当て」**ページで、**「ビジネス」**タブを選択して、SharePoint と Salesforce の両方が表示されるようにします。

8. **「次へ」**をクリックします。

9. **「範囲を決める」**ページで、**「すべての環境の追加」**を選択し、**「次へ」**を選択します。

10. **「ポリシーの確認と作成」**ページで、ポリシーの設定を確認し、**「ポリシーの作成」**を選択します。

SharePoint Online コネクタと SalesForce でないすべてのコネクタを利用するフローをユーザーが作成することを防止する Power Platform の DLP ポリシーが作成されました。

# 演習 2 に進みます。
